<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Maps API</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col text-center">
        <h1>My First Google Map</h1>
      </div>
    </div>
    <div class="row">
        <div class="col">
          <div id="map" class="rounded" style="width:100%;height:400px;"></div>
        </div>
    </div>  
    <div class="row" style="margin-top:30px;">
      <div class="col text-center">
        <button onclick="myLoc()" class="btn btn-primary">Localizar</button>
      </div>
    </div>
  </div>

  
    <script>
        var home = {lat: -33.4470996, lng: -70.600959}; 
        var work = {lat:-33.4291909, lng: -70.599858};
        var map;
        var infowindow = [];
        var names = [];
        
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            center: home,
            zoom: 12
          });
        var script = document.createElement('script');

        script.src = './lugares.js';
        document.getElementsByTagName('head')[0].appendChild(script);
  
        }
        window.eqfeed_callback = function(results) {

          for (var i = 0; i < results.features.length; i++) {
            
            var coords = results.features[i].geometry.coordinates;
            var name = results.features[i].properties.name;
            var imagen = results.features[i].properties.foto;
            // names[i]=name;

            
            var latLng = new google.maps.LatLng(coords[1],coords[0]);
            var marker = new google.maps.Marker({
              position: latLng,
              map: map,
              title: 'Click to zoom '+name,
              name: name,
              imagen: imagen,
            });
            var infowindow = new google.maps.InfoWindow();
            google.maps.event.addListener(marker, 'click', (function(marker) {
                       return function() {
                        //  console.log(name);
                         console.log(marker.imagen);
                         
                           var content = '<div class="content" style="width:50px;height:50px;"><img src="'+marker.imagen+'" width="50" height="50" alt="" class="img-fluid rounded-circle"></div>';
                          //  var content = marker.imagen;
                           infowindow.setContent(content);
                           infowindow.open(map, marker);
                           map.setZoom(18);
                           map.setCenter(marker.getPosition());
                       }
                     })(marker));
          }
          
        }

        function myLoc() {
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
              map.setCenter(pos);
              map.setZoom(15);

              var marker = new google.maps.Marker({
          position: pos,
          map: map
        });


            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        }
  
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
          infoWindow.open(map);
        }

    </script>



    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6pdeKZMn-BYI9w42UB8GURDR6Do8l9PA&callback=initMap"
    type="text/javascript"></script>
  
</body>
</html>