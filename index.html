<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Maps API</title>
</head>
<body>
    <h1>My First Google Map</h1>

    <div id="map" style="width:100%;height:400px;"></div>

    <button onclick="myLoc()">localizar</button>

    <script>
        var home = {lat: -33.4470996, lng: -70.600959}; 
        var work = {lat:-33.4291909, lng: -70.599858};
        var map;
        var infowindow = [];
        var names = [];
        
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            center: home,
            zoom: 12
          });
        var script = document.createElement('script');

        script.src = './lugares.js';
        document.getElementsByTagName('head')[0].appendChild(script);
  
        }
        window.eqfeed_callback = function(results) {

          for (var i = 0; i < results.features.length; i++) {
            
            var coords = results.features[i].geometry.coordinates;
            var name = results.features[i].properties.name;
            names[i]=name;

            
            var latLng = new google.maps.LatLng(coords[1],coords[0]);
            var marker = new google.maps.Marker({
              position: latLng,
              map: map,
              title: 'Click to zoom '+name,
              name: name,
            });
            var infowindow = new google.maps.InfoWindow();
            google.maps.event.addListener(marker, 'click', (function(marker) {
                       return function() {
                         console.log(name);
                         console.log(marker);
                         
                           var content = marker.name;
                           infowindow.setContent(content);
                           infowindow.open(map, marker);
                           map.setZoom(18);
                           map.setCenter(marker.getPosition());
                       }
                     })(marker));
          }
          
        }

        function myLoc() {
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
  
              // infoWindow.setPosition(pos);
              // infoWindow.setContent('Location found.');
              // infoWindow.open(map);
              map.setCenter(pos);
              map.setZoom(15);

              var marker = new google.maps.Marker({
          position: pos,
          map: map
        });


            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        }
  
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
          infoWindow.open(map);
        }

    </script>



    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6pdeKZMn-BYI9w42UB8GURDR6Do8l9PA&callback=initMap"
    type="text/javascript"></script>
  
</body>
</html>